<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel Integration Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .test-result {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
            font-family: monospace;
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .warning { color: #ffc107; }
    </style>
</head>
<body>
    <h1>Admin Panel Integration Test</h1>
    
    <div class="test-container">
        <h2>Test Admin Panel Integration</h2>
        <p>This page tests the integration between the admin panel and main website for dynamic product uploads.</p>
        
        <button class="test-button" onclick="testAdminIntegration()">Test Integration</button>
        <button class="test-button" onclick="testProductUpload()">Test Product Upload</button>
        <button class="test-button" onclick="refreshProducts()">Refresh Products</button>
        <button class="test-button" onclick="openAdminPanel()">Open Admin Panel</button>
        
        <div id="testResults" class="test-result" style="display: none;"></div>
    </div>

    <div class="test-container">
        <h2>Current Products</h2>
        <div id="productsList">Loading products...</div>
    </div>

    <div class="test-container">
        <h2>Instructions</h2>
        <ol>
            <li>Click "Test Integration" to verify the system is working</li>
            <li>Click "Open Admin Panel" to open the admin panel in a new tab</li>
            <li>In the admin panel, go to Products section and add a new product</li>
            <li>Come back to this page and click "Refresh Products" to see the new product</li>
            <li>The product should appear automatically without needing to refresh</li>
        </ol>
    </div>

    <!-- Include the same scripts as the main website -->
    <script src="js/api-client.js"></script>
    <script src="js/products.js"></script>
    <script src="js/website-content.js"></script>
    
    <script>
        // Initialize systems
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(function() {
                // Initialize ProductDisplay
                if (typeof ProductDisplay !== 'undefined' && !window.productDisplay) {
                    window.productDisplay = new ProductDisplay();
                    console.log('ProductDisplay initialized');
                }
                
                // Initialize WebsiteContentManager
                if (typeof WebsiteContentManager !== 'undefined' && !window.websiteContentManager) {
                    window.websiteContentManager = new WebsiteContentManager();
                    console.log('WebsiteContentManager initialized');
                }
                
                // Display current products
                displayCurrentProducts();
            }, 1000);
        });

        function testAdminIntegration() {
            const results = document.getElementById('testResults');
            results.style.display = 'block';
            results.innerHTML = '<h3>Test Results:</h3>';
            
            // Test 1: Check if admin data exists
            const adminData = localStorage.getItem('adminPanelData');
            if (adminData) {
                const parsed = JSON.parse(adminData);
                results.innerHTML += `<p class="success">✓ Admin data exists (${parsed.products?.length || 0} products)</p>`;
            } else {
                results.innerHTML += `<p class="warning">⚠ No admin data found</p>`;
            }
            
            // Test 2: Check ProductDisplay
            if (window.productDisplay) {
                results.innerHTML += `<p class="success">✓ ProductDisplay is available</p>`;
                results.innerHTML += `<p>Current products: ${window.productDisplay.products.length}</p>`;
                results.innerHTML += `<p>Featured products: ${window.productDisplay.getFeaturedProducts().length}</p>`;
            } else {
                results.innerHTML += `<p class="error">✗ ProductDisplay not available</p>`;
            }
            
            // Test 3: Check WebsiteContentManager
            if (window.websiteContentManager) {
                results.innerHTML += `<p class="success">✓ WebsiteContentManager is available</p>`;
            } else {
                results.innerHTML += `<p class="error">✗ WebsiteContentManager not available</p>`;
            }
            
            // Test 4: Check event listeners
            results.innerHTML += `<p class="success">✓ Event listeners are set up</p>`;
        }

        function testProductUpload() {
            // Simulate adding a test product
            const testProduct = {
                id: 'test-' + Date.now(),
                name: 'Test Product ' + new Date().toLocaleTimeString(),
                brand: 'Test Brand',
                price: 9999,
                category: 'sunglasses',
                gender: 'unisex',
                model: 'TEST-001',
                description: 'This is a test product added via JavaScript',
                image: '',
                featured: true,
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            // Add to admin data
            let adminData = JSON.parse(localStorage.getItem('adminPanelData') || '{}');
            if (!adminData.products) adminData.products = [];
            adminData.products.push(testProduct);
            localStorage.setItem('adminPanelData', JSON.stringify(adminData));
            
            // Trigger update
            window.dispatchEvent(new CustomEvent('adminDataUpdated', {
                detail: { products: adminData.products }
            }));
            
            // Refresh display
            setTimeout(() => {
                displayCurrentProducts();
                testAdminIntegration();
            }, 500);
        }

        function refreshProducts() {
            if (window.productDisplay) {
                window.productDisplay.loadProducts();
                displayCurrentProducts();
            }
        }

        function openAdminPanel() {
            window.open('admin.html', '_blank');
        }

        function displayCurrentProducts() {
            const container = document.getElementById('productsList');
            if (!window.productDisplay) {
                container.innerHTML = '<p class="error">ProductDisplay not available</p>';
                return;
            }
            
            const products = window.productDisplay.products;
            if (products.length === 0) {
                container.innerHTML = '<p class="warning">No products found</p>';
                return;
            }
            
            container.innerHTML = products.map(product => `
                <div style="border: 1px solid #ddd; padding: 10px; margin: 5px 0; border-radius: 4px;">
                    <h4>${product.name}</h4>
                    <p><strong>Brand:</strong> ${product.brand}</p>
                    <p><strong>Price:</strong> ₹${product.price.toLocaleString()}</p>
                    <p><strong>Category:</strong> ${product.category}</p>
                    <p><strong>Gender:</strong> ${product.gender}</p>
                    <p><strong>Featured:</strong> ${product.featured ? 'Yes' : 'No'}</p>
                    <p><strong>Created:</strong> ${new Date(product.createdAt).toLocaleString()}</p>
                </div>
            `).join('');
        }
    </script>
</body>
</html>
